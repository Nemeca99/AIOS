// UPDATED HTML TEMPLATE FOR THE WEB INTERFACE

// Add these buttons right after the mode selector buttons
<div class="conversion-controls mt-3">
    <div class="row">
        <div class="col">
            <button class="btn btn-info btn-sm w-100" onclick="convertExpression('uml')">Convert to UML</button>
        </div>
        <div class="col">
            <button class="btn btn-warning btn-sm w-100" onclick="convertExpression('base52')">Convert to Base52</button>
        </div>
        <div class="col">
            <button class="btn btn-secondary btn-sm w-100" onclick="runTestSuite()">Run Tests</button>
        </div>
    </div>
</div>

// Add this modal for displaying test results
<div class="modal fade" id="resultsModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Test Suite Results</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="resultsModalBody">
                <!-- Results will be inserted here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

// Add these JavaScript functions to the script section
function convertExpression(type) {
    const expr = document.getElementById('expression').value;
    if (!expr) return;
    
    fetch('/api/convert', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ expr: expr, convert_to: type })
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            displayResult(data.error);
        } else {
            document.getElementById('expression').value = data.converted;
            displayResult(data.result);
            updateHistory(data.history);
        }
    })
    .catch(error => {
        displayResult('Conversion error: ' + error);
    });
}

function runTestSuite() {
    displayResult('Running test suite...');
    
    fetch('/api/test-suite', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
    })
    .then(response => response.json())
    .then(data => {
        const resultsModal = new bootstrap.Modal(document.getElementById('resultsModal'));
        
        let tableHtml = '<table class="table table-striped"><thead><tr><th>Expression</th><th>Standard</th><th>UML</th><th>Base52</th></tr></thead><tbody>';
        
        for (const [expr, results] of Object.entries(data.results)) {
            tableHtml += `<tr><td>${expr}</td>`;
            
            // Standard column
            if (results.standard.status === 'success') {
                tableHtml += `<td class="text-success">${results.standard.result}</td>`;
            } else {
                tableHtml += `<td class="text-danger">${results.standard.error || 'Error'}</td>`;
            }
            
            // UML column
            if (results.uml.status === 'success') {
                tableHtml += `<td class="text-success">${results.uml.result}</td>`;
            } else {
                tableHtml += `<td class="text-danger">${results.uml.error || 'Error'}</td>`;
            }
            
            // Base52 column
            if (results.base52.status === 'success') {
                tableHtml += `<td class="text-success">${results.base52.result}</td>`;
            } else {
                tableHtml += `<td class="text-danger">${results.base52.error || 'Error'}</td>`;
            }
            
            tableHtml += '</tr>';
        }
        
        tableHtml += '</tbody></table>';
        
        document.getElementById('resultsModalBody').innerHTML = tableHtml;
        resultsModal.show();
    })
    .catch(error => {
        displayResult('Test suite error: ' + error);
    });
}
