<!DOCTYPE html>
<html>
<head>
    <title>Calculator Button Test</title>
</head>
<body>
    <input type="text" id="calc-screen" value="0" style="font-size: 2em; padding: 10px;">
    <br><br>
    <button class="vk-btn" data-key="1">1</button>
    <button class="vk-btn" data-key="2">2</button>
    <button class="vk-btn" data-key="+">+</button>
    <button class="vk-btn" data-key="=">=</button>
    <button class="vk-btn" data-key="C">C</button>
    
    <script>
        let screen = document.getElementById('calc-screen');
        let expr = '';
        
        function updateScreen(val) {
            screen.value = val || '0';
        }
        
        function clearScreen() {
            expr = '';
            updateScreen(expr);
        }
        
        function appendScreen(val) {
            expr += val;
            updateScreen(expr);
        }
        
        function submitCalc() {
            fetch('http://127.0.0.1:5000/api/calc', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ expr: expr, output_mode: 'standard' })
            })
            .then(res => res.json())
            .then(data => {
                updateScreen(data.result);
                expr = '';
                console.log('Result:', data.result);
            })
            .catch(err => {
                console.error('Error:', err);
                updateScreen('Err');
            });
        }
        
        function handleKey(key) {
            console.log('handleKey called with:', key);
            if (key === 'C') { clearScreen(); return; }
            if (key === '=') { submitCalc(); return; }
            appendScreen(key);
        }
        
        // Attach button handlers
        const buttons = document.querySelectorAll('.vk-btn');
        console.log('Found', buttons.length, 'buttons');
        buttons.forEach(btn => {
            btn.onclick = function() { 
                console.log('Button clicked:', this.getAttribute('data-key'));
                handleKey(this.getAttribute('data-key')); 
            };
        });
        
        console.log('Calculator test ready!');
    </script>
</body>
</html>
